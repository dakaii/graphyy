name: Run tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.22

    - name: Build the test
      run: |
        docker-compose -f docker-compose.test.yml build 
    
    - name: Run the test
      run: |
        docker-compose -f docker-compose.test.yml up --abort-on-container-exit

    - name: Clean up
      run: |
        docker-compose -f docker-compose.test.yml down --volumes
